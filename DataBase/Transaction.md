# Transaction

### 트랜잭션
트랜잭션은 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미한다.

에를 들어 은행에서 계좌이체를 할 때 내 계좌에서 계좌이체한 잔액을 빼는 것과 상대방 계좌에 잔액을 더하는 일은 한번에 수행이 되어야 하지 나누어서 처리를 하면 안된다. 즉, 내 계좌에서 잔액을 빼는 일과 상대방 계좌에서 잔액을 더하는 일은 하나의 업무로 묶어서 진행되어야 하는 일이라는 것이다.

### 트랜잭션의 특징
* 트랜잭션은 데이터베이스 시스템에서 병행 제어 및 회복 작업 시 처리되는 작업의 논리적 단위이다.
* 하나의 트랜잭션은 Commit되거나 Rollback된다.
* 트랜잭션은 데이터베이스의 안전성을 보장하기 위한 것이다.

### 트랜잭션의 성질
* Atomicity(원자성)
    * 트랜잭션이 데이터베이스에 모두 반영되던가, 아니면 전혀 반영되지 않아야 한다.
    * 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 하며, 하나라도 오류가 발생하면 전부 취소되어야 한다.
* Consistency(일관성)
    * 트랜잭션의 작업 처리가 성공적으로 완료되면 결과가 항상 일관성이 있어야 한다.
    * 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 완료 후의 상태가 같아야 한다.
        * 예를 들어 계좌이체를 성공하면 내 계좌와 상대방 계좌 잔액의 합이 트랜잭션 실행 전의 합과 같아야 한다.
* Isoliation(독립성, 격리성)
    * 둘 이상의 트랜잭션이 동시에 병행 실행되고 있을 경우에 어느 하나의 트랜잭션이라도 다른 트랜잭션의 연산에 끼어들 수 없다.
    * 수행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에 수행 결과를 참조할 수 없다.
* Durablility(영속성, 지속성)
    * 트랜잭션이 성공적으로 완료됬을 경우, 시스템이 고장나더라도 영구적으로 반영되어야 한다(Hardware Level).

### 트랜잭션의 Commit, Rollback
* Commit
    * 트랜잭션이 성공적으로 끝나고, 데이터베이스가 일관성있는 상태에 있을 때 트랜잭션이 끝났다는 것을 알려주는 연산이다.
* Rollback
    * 트랜잭션이 비정상적으로 종료되어 트랜잭션의 원자성이 깨진경우, 트랜잭션을 처음부터 다시 시작하거나, 트랜잭션이 행한 모든 연산을 취소해야 한다.

### 트랜잭션을 사용할 시 주의사항
트랜잭션은 데이터의 완전성을 위해 많은 자원들을 사용하게 된다.

자원을 사용하며 Lock을 걸게 되면 다른 사용자들은 Lock이 해제될 때까지 기다려야 한다. 기다린다는 것은 성능에 좋지 않기 때문에, 트랜잭션의 범위를 최소화하여 적용하는 것이 좋다.

참고
https://mommoo.tistory.com/62
https://coding-factory.tistory.com/226
https://nesoy.github.io/articles/2018-05/Database-Transaction

