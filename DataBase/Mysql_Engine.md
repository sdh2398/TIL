# Mysql 엔진

Mysql은 크게 2가지 구조로 되어 있다.
* 서버 엔진 : 클라이언트가 Query를 요청했을 때, Query Parsing과, 스토리지 엔진에 데이터를 요청하는 작업 등을 수행한다.
* 스토리지 엔진 : 물리적 저장장치에서 데이터를 읽어오는 역할을 담당한다.

스토리지 엔진은 데이터를 직접적으로 다루는 역할을 하므로 엔진 종류 마다 동작원리가 다르다. 따라서 트랜잭션, 성능과 같은 주요 이슈에도 밀접하게 연관되어 있다.

### InnoDB
* 따로 스토리지 엔진을 명시하지 않으면 default로 설정되는 스토리지 엔진이다.
* Transaction-safe하다.
* 커밋과 롤백, 그리고 데이터 복구 기능을 제공하므로 데이터를 효과적으로 보호 할 수 있다.
* row-level locking을 제공한다.
* 데이터를 clustered index에 저장하여 PK 기반의 query의 I/O 비용을 줄인다.
* FK 제약을 제공하여 데이터 무결성을 보장한다.

### MyISAM
* 트랜잭션을 지원하지 않는다.
* table-level locking을 제공한다. 따라서 multi-thread 환경에서 성능이 저하 될 수 있다.
    * 특정 세션이 테이블을 변경하는 동안 테이블 단위로 lock이 잡히기 때문이다.
* 텍스트 전문 검색(Fulltext Searching)과 지리 정보 처리 기능도 지원한다.
    * 이를 사용할 떄는 파티셔닝을 할 수 없다는 단점이 있다.

### Maria
* MyISAM의 후속으로 개발되고 있는 엔진이다.
* MyISAM에 비해 트랜잭션 기능과 비정상 종료 시 복구 기능을 추가한 것으로 MyISAM의 약점이 보완됬다.


### Archive
* '로그 수집'에 적합한 엔진이다.
* 데이터가 메모리상에서 압축된 상태로 디스크에 저장되기 때문에 row-level locking이 가능하다.
* 한번 insert된 데이터는 update delete를 사용할 수 없으며 인덱스를 지원하지 않는다.
    * 거의 가공하지 않을 원시 로그 데이터를 관리하는데 효율적일 수 있다.
* 테이블 파티셔닝을 지원한다.
* 트랜잭션은 지원하지 않는다.

1대의 서버에 두 가지를 혼용하는 것은 좋지 않다. 이들은 각기 다른 동작, 메모리 사용법을 취하므로 혼용하는 환경에서는 효율적인 CPU, 메모리 사용이 어려워진다.

오라클에는 Mysql과 같이 스토리지 엔진 개념이 없다. InnoDB와 가장 유사하게 데이터를 관리한다.

### InnoDb vs MyISAM

InnoDB가 유리한 경우
* 대용량의 데이터를 컨트롤 하는 경우
* 트랜잭션 관리가 필요한 경우
* 복구가 필요할 경우
* 정렬들의 구문이 들어가는 경우
* IUD 등이 빈번하게 발생하는 경우(Row-Level Locking 때문에)

MyISAM이 유리한 경우
* 읽기 위주의 작업만 필요할 경우
    * select count(*) from table; 같은 쿼리의 경우에도 MyISAM의 경우 레코드 개수를 따로 저장(레코드 명세에 row count가 있다)해 두어 0.00초도 안걸리지만 InnoDB는 일일이 테이블의 레코드 수를 구하기 때문에 시간이 많이 걸린다.
* 전문 검색이 필요할 경우
* 트랜잭션이나 복구등이 필요 없을 경우
* 한번에 대량의 데이터를 입력하는 배치성 테이블

참고
http://asuraiv.blogspot.com/2017/07/mysql-storage-engine.html
https://needjarvis.tistory.com/45
https://12bme.tistory.com/95
https://wedul.site/449