# 안전한 패스워드

보안 시스템에는 약한 고리가 끊어지면 다른 고리가 얼마나 강한지는 문제가 되지 않는다. 즉, 보안 시스템은 **강한 부분이 얼마나 강한가**보다는 **약한 부분이 얼마나 약한가**에 따라서 좌우된다.

### 단방향 해시 함수
보통 다음 두가지 중 한 가지로 패스워드를 저장한다.
* 단순 텍스트
* 단방향 해시 함수의 다이제스트

단순 텍스트로 패스워드를 저장하는 것은 범죄를 저지르는 것이나 다름없다.

단방향 해시 함수는 수학적인 연산을 통해 원본 메시지를 변환하여 암호화된 메시지인 다이제스트를 생성한다.
* 원본 메시지에서 암호화된 메시지를 구할 순 있지만, 암호화된 메시지로는 원본 메시지를 구할 수 없다.

### 단방향 해시 함수의 문제점
대부분의 웹 사이트에서는 SHA-256과 같은 해시 함수를 사용해 패스워드를 암호화해 저장하고 값을 비교한다. 하지만 다음과 같은 문제점이 있다.
* 인식 가능성(recognizability)
    * 동일한 메시지가 언제나 동일한 다이제스트를 갖는다면 전처리된 다이제스트를 가지고 탈취한 다이제스트와 비교해 원본 메시지를 찾아내거나 동일한 효과의 메시지를 찾을 수 있다.
* 속도
    * 해시 함수는 패스워드를 저장하기 위해 설계된 것이 아니라, 짧은 시간에 데이터를 검색하기 위해 설계된 것이다.
    * 해시 함수의 빠른 처리 속도로 인해 공격자는 매우 빠른 속도로 임의의 문자열의 다이제스트와 탈취한 다이제스트를 비교할 수 있다.
        * MD5를 사용한 경우 일반적인 장비로 1초당 56억 개의 다이제스트를 대입할 수 있다.

사용자는 패스워드를 입력했을 때, 0.1초대신 1초가 소요된다고 해서 신경쓰지 않는다. 즉, 해시 함수의 빠른 처리 속도는 사용자들보다 공격자들에게 더 큰 편의성을 제공한다.

### 단방향 해시 함수 보완하기
* 솔팅
    * 해시 함수에서 다이제스트를 생성할 때 임의의 문자열(솔트)을 추가해서 생성한다.
    * 해당 비밀번호의 다이제스트를 알아내더라도 솔팅된 다이제스트를 대상으로 일치 여부를 확인하기 어렵다.
    * 사용자별로 다른 솔트를 사용한다면 인식 가능성(recognizability) 문제가 크게 개선된다.
    * 솔트와 패스워드의 다이제스트를 DB에 저장하고, 사용자가 로그인할 때 입력한 패스워드를 해시하여 일치 여부를 확인할 수 있다.
* 키 스트레칭(key stretching)
    * 다이제스트를 생성하고, 생성된 다이제스트를 입력 값으로 하여 다이제스트를 반복적으로 생성하는 방법이다.
    * 패스워드를 동일한 횟수만큼 해시해야만 입력한 패스워드의 일치 여부를 확인할 수 있다.

### Adaptive Key Derivation Functions
adaptive key derivation function은 다이제스트를 생성할 때 솔팅과 키 스트레칭을 반복하며 솔트와 패스워드 외에도 입력 값을 추가하여 공격자가 쉽게 다이제스트를 유추할 수 없도록 하고 보안의 강도를 선택할 수 있다.

주요한 key derivation function은 다음과 같다.
* PBKDF2
    * 가장 많이 사용되는 key derivation function이다.
    * 해시 함수의 컨테이너인 PBKDF2는 솔트를 적용한 후 해시 함수의 반복 횟수를 임의로 선택할 수 있다.
    * NIST(미국표준기술연구소)에 의해서 승인된 알고리즘이고, 미국 정부 시스템에서도 사용자 패스워드를 암호화된 다이제스트를 생성할 때 사용한다.
* bcrypt
    * 애초에 패스워드 저장을 목적으로 설계되었다.
    * 가장 강력한 해시 매커니즘 중 하나이다.
    * 보안에 집착하기로 유명한 OpenBSD에서 기본 암호 인증 메커니즘으로 사용되고 있다.
* scrypt
    * PBKDF2와 유사하다.
    * 다이제스트를 생성할 때 메모리 오버헤드를 갖도록 설계되어, brute-force attack을 시도할 때 병렬화 처리가 매우 어렵다.

### 결론
해시 함수는 메시지 인증과 무결성 체크를 위한 것이다. 이것을 패스워드 인증을 위해 사용하면 인식 가능성, 빠른 처리 속도에 기안하는 취약점이 존재한다.

이를 해결 하기 위해 key derivation function을 사용하는 것을 권장한다.

매우 강력한 패스워드 다이제스트를 생성하는 시스템을 쉽게 구현하고 싶다면 bcrypt를 사용하는 것이 좋다. 대부분의 프로그래밍 언어에라이브러리를 제공해준다.

구현하려는 시스템이 매우 민감한 정보를 다루고, 보안 시스템을 구현하는 많은 비용을 투자할 수 있다면 scrypt를 사용하면 된다.

하지만, 사용자가 안전한 패스워드를 설정하도록 패스워드 정책을 설정하는 것이 매우 중요하다.

참고
* https://d2.naver.com/helloworld/318732